<div id="chat"></div>
<head><link rel="stylesheet" href="/style.css">
</head>

<form id="form" enctype="multipart/form-data">
  <input name="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆ">
  <input name="image" type="file">
  <button>é€ä¿¡</button>
</form>

<script>
fetch("/me").then(r=>r.json()).then(me=>{
  if(!me) location.href="/login.html";
});

function load(){
  fetch("/comments").then(r=>r.json()).then(list=>{
    chat.innerHTML="";
    list.forEach(m=>{
      chat.innerHTML+=`
        <div>
          <b>${m.user}</b> (${m.plan})
          <div>${m.comment}</div>
          ${m.image?
            `<img src="/uploads/${m.image}">
             ${m.plan==="paid"?
               `<a href="/download/${m.image}">DL</a>`:
               `<span>ğŸ”’DLä¸å¯</span>`}`
          :""}
        </div>`;
    });
  });
}
load();

form.onsubmit=e=>{
  e.preventDefault();
  fetch("/post",{method:"POST",body:new FormData(form)})
    .then(()=>{form.reset();load();});
};
</script>
